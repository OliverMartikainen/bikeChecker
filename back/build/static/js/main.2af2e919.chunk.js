(this.webpackJsonpbike_checker=this.webpackJsonpbike_checker||[]).push([[0],{17:function(e,t,a){e.exports=a(45)},22:function(e,t,a){},23:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){},44:function(e,t,a){},45:function(e,t,a){"use strict";a.r(t);var n,r=a(0),c=a.n(r),l=a(15),o=a.n(l),s=(a(22),a(3)),u=(a(23),a(1)),i=a.n(u),m=a(4),E={BIKE_API_URI:"./api",LOGIN_API_URI:"https://safe-retreat-57854.herokuapp.com"},b=a(5),f=a.n(b),p=function(){return{headers:{Authorization:n}}},d=function(e){n=e?"bearer ".concat(e):null},I="".concat(E.BIKE_API_URI,"/v1/bikeData"),S=0,v={getBikeData:function(){var e=Object(m.a)(i.a.mark((function e(){var t,a,n,r,c,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(new Date).valueOf(),6e4,!(S>t-6e4)){e.next=4;break}return e.abrupt("return",null);case 4:return e.prev=4,a=p(),e.next=8,f.a.get(I,a);case 8:if(200===(n=e.sent).status&&n.data&&n.data.bikeData){e.next=12;break}return console.log("BIKEDATA: FETCH FAILED",n.status),e.abrupt("return",null);case 12:return r=n.data.bikeData,c=r.lastFetchTime,l=r.stations,S=c,e.abrupt("return",{lastFetchTime:c,stations:l});case 17:return e.prev=17,e.t0=e.catch(4),e.t0.response?console.log("BIKEDATA: FETCH FAILED",e.t0.response.statusText):console.log("BIKEDATA: FETCH FAILED",e.t0.status),e.abrupt("return",null);case 21:case"end":return e.stop()}}),e,null,[[4,17]])})));return function(){return e.apply(this,arguments)}}(),resetLastFetchTime:function(){return S=0}},g=a(16),h=(a(42),"".concat(E.LOGIN_API_URI,"/api/users")),O="".concat(E.LOGIN_API_URI,"/api/login"),A="".concat(E.LOGIN_API_URI,"/api/storeStation"),k={login:function(){var e=Object(m.a)(i.a.mark((function e(t,a){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.a.post(O,{username:t,password:a});case 3:if(201===(n=e.sent).status&&n.data){e.next=7;break}return console.log("LOGIN: FAILED",n.status),e.abrupt("return",{isLoggedIn:!1});case 7:return console.log("LOGIN DONE"),(r=n.data.token)&&d(r),""!==n.data.token&&window.localStorage.setItem("userToken",n.data.token),e.abrupt("return",{isLoggedIn:!0,homeStation:n.data.homeStation});case 14:return e.prev=14,e.t0=e.catch(0),console.error("LOGIN: FAILED",e.t0.message),e.abrupt("return",{isLoggedIn:!1});case 18:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,a){return e.apply(this,arguments)}}(),createUser:function(){var e=Object(m.a)(i.a.mark((function e(t,a){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&a){e.next=2;break}return e.abrupt("return",{bCreated:!1,message:"MISSING USERNAME OR PASSWORD"});case 2:return e.prev=2,e.next=5,f.a.post(h,{username:t,password:a});case 5:if(201===(n=e.sent).status&&n.data){e.next=9;break}return console.log("LOGIN: FAILED",n.status),e.abrupt("return",{bCreated:!1,message:"USERNAME IN USE EXISTS"});case 9:return console.log("CREATED USER AND LOGGED IN DONE"),(r=n.data.token)&&d(r),""!==n.data.token&&window.localStorage.setItem("userToken",n.data.token),e.abrupt("return",{bCreated:!0,message:"USER CREATED"});case 16:return e.prev=16,e.t0=e.catch(2),console.error(e.t0.message),e.abrupt("return",{bCreated:!1,message:"USERNAME IN USE"});case 20:case"end":return e.stop()}}),e,null,[[2,16]])})));return function(t,a){return e.apply(this,arguments)}}(),storeHomeStation:function(){var e=Object(m.a)(i.a.mark((function e(t){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={station:t},console.log(a),n=p(),e.next=6,f.a.post(A,a,n);case 6:e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0.message);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()},N=function(e){var t=e.station,a=e.selectCenter,n=e.isCenter,r=t.name,l=t.bikesAvailable,o=l+t.spacesAvailable,s="".concat(l," / ").concat(o),u=n?"station-list-item center":"station-list-item",i="bad";return l>3?i="good":l>0&&(i="neutral"),c.a.createElement("tr",{className:u,onDoubleClick:function(){return a(t)}},c.a.createElement("td",null,r),c.a.createElement("td",null,s),c.a.createElement("td",null,c.a.createElement("div",{className:"status-marker ".concat(i)})))},w=function(e){var t=e.centerId,a=e.setCenter,n=e.stations,l=e.lastFetchTime,o=Object(r.useState)(""),u=Object(s.a)(o,2),i=u[0],m=u[1];if(0===n.length)return c.a.createElement("div",null,c.a.createElement("br",null),"FETCHING DATA - WAIT A MOMENT");var E=function(e){var t=Object(g.a)({lastFetchTime:l},e);window.localStorage.setItem("centerStation",JSON.stringify(t)),k.storeHomeStation(t),a(t)},b=i.toLowerCase(),f=n.filter((function(e){return e.name.toLowerCase().includes(b)})).map((function(e){return c.a.createElement(N,{key:e.stationId,station:e,selectCenter:E,isCenter:e.stationId===t})}));return c.a.createElement("div",null,c.a.createElement("br",null),"FILTER STATIONS: ",c.a.createElement("input",{onChange:function(e){return m(e.target.value)},list:"nameData",value:i,type:"search"}),c.a.createElement("br",null),"Double Click to select",c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement("table",{id:"station-list-table"},c.a.createElement("thead",null,c.a.createElement("tr",null,c.a.createElement("th",null,"NAME"),c.a.createElement("th",null,"BIKES/SPACE"))),c.a.createElement("tbody",null,f)),c.a.createElement("datalist",{id:"nameData"},n.map((function(e){return c.a.createElement("option",{key:e.stationId,value:e.name})}))))},T=(a(43),function(){var e=Object(m.a)(i.a.mark((function e(t){var a,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.getBikeData();case 2:if((a=e.sent)&&0!==a.lastFetchTime&&0!==a.stations.length){e.next=5;break}return e.abrupt("return");case 5:n=a.lastFetchTime,r=a.stations,t({lastFetchTime:n,stations:r});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),D=function(e){var t=e.center,a=t.name,n=t.bikesAvailable,r=n+t.spacesAvailable,l="".concat(n," / ").concat(r),o="bad";return n>3?o="good":n>0&&(o="neutral"),c.a.createElement("table",{id:"center-table",className:o},c.a.createElement("thead",null,c.a.createElement("tr",{key:1},c.a.createElement("th",null,"NAME"),c.a.createElement("th",null,"BIKES/SPACE"))),c.a.createElement("tbody",null,c.a.createElement("tr",null,c.a.createElement("td",null,a),c.a.createElement("td",null,l))))},R=function(){var e=Object(r.useState)({lastFetchTime:0,stations:[]}),t=Object(s.a)(e,2),a=t[0],n=t[1],l=Object(r.useState)((function(){return function(){var e={name:"NO CENTER SELECTED",bikesAvailable:0,spacesAvailable:0,stationId:null};try{var t=window.localStorage.getItem("centerStation");return t?JSON.parse(t):e}catch(a){return e}}()})),o=Object(s.a)(l,2),u=o[0],i=o[1],m=Object(r.useState)(!u.stationId),E=Object(s.a)(m,2),b=E[0],f=E[1],p=a.lastFetchTime,d=a.stations;Object(r.useEffect)((function(){T(n);var e=setInterval((function(){T(n)}),1e4);return function(){v.resetLastFetchTime(),clearTimeout(e)}}),[]);var I=d.find((function(e){return e.stationId===u.stationId}))||u,S=new Date(p||u.lastFetchTime).toLocaleString(),g=b?"HIDE LIST":"CHANGE STATION";return c.a.createElement("div",{id:"station-screen"},c.a.createElement("div",{id:"center-screen"},c.a.createElement("h2",null,"YOUR STATION"),c.a.createElement(D,{center:I}),c.a.createElement("br",null),S),c.a.createElement("br",null),c.a.createElement("button",{onClick:function(){return f((function(e){return!e}))}},g),c.a.createElement("br",null),b&&c.a.createElement(w,{centerId:u.stationId,setCenter:i,stations:d,lastFetchTime:p}))},C=(a(44),["id","user_id","name","bikes_available","spaces_available","realtime","lat","lon","allow_drop_off","last_fetch_time"]),L=function(e){var t=e.setUser,a=Object(r.useState)(""),n=Object(s.a)(a,2),l=n[0],o=n[1],u=Object(r.useState)(""),E=Object(s.a)(u,2),b=E[0],f=E[1],p=Object(r.useState)(""),d=Object(s.a)(p,2),I=d[0],S=d[1],v=function(){var e=Object(m.a)(i.a.mark((function e(a){var n,r,c,o,s,u,m,E,f,p,d,I,v;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),""!==l&&""!==b){e.next=6;break}return console.log("MISSIN USERNAME OR PASSWORD"),S("MISSIN USERNAME OR PASSWORD"),setTimeout((function(){S("")}),5e3),e.abrupt("return");case 6:return e.next=8,k.login(l,b);case 8:if(n=e.sent,r=n.isLoggedIn,c=n.homeStation,r){if(c&&C.every((function(e){return c[e]}))){o=c.name,s=c.id,u=c.last_fetch_time,m=c.bikes_available,E=c.spaces_available,f=c.realtime,p=c.lat,d=c.lon,I=c.allow_drop_off;try{v={name:o,stationId:s,bikesAvailable:m,spacesAvailable:E,realtime:f,lat:p,lon:d,allowDropoff:I,lastFetchTime:u},window.localStorage.setItem("centerStation",JSON.stringify(v))}catch(i){console.error(i)}}window.localStorage.setItem("storedUser",l),t(l)}else console.log("LOGIN FAILED"),S("INVALID USER INFORMATION"),setTimeout((function(){S("")}),5e3);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=Object(m.a)(i.a.mark((function e(a){var n,r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),""!==l&&""!==b){e.next=6;break}return console.log("MISSIN USERNAME OR PASSWORD"),S("MISSIN USERNAME OR PASSWORD"),setTimeout((function(){S("")}),5e3),e.abrupt("return");case 6:return e.next=8,k.createUser(l,b);case 8:n=e.sent,r=n.bCreated,c=n.message,r?(window.localStorage.setItem("storedUser",l),t(l)):(console.log("LOGIN FAILED"),S(c),setTimeout((function(){S("")}),5e3));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return c.a.createElement("div",{id:"login-screen"},c.a.createElement("form",{onSubmit:v},"USERNAME: ",c.a.createElement("input",{onChange:function(e){return o(e.target.value)},value:l,name:"username"}),c.a.createElement("br",null),"PASSWORD: ",c.a.createElement("input",{type:"password",onChange:function(e){return f(e.target.value)},name:"password",value:b}),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement("button",{type:"submit"},"LOGIN USER"),c.a.createElement("button",{type:"button",onClick:g},"CREATE USER"),c.a.createElement("br",null),c.a.createElement("br",null),I,c.a.createElement("br",null)))},U=function(){var e=Object(r.useState)(function(){try{var e=window.localStorage.getItem("storedUser"),t=window.localStorage.getItem("userToken");return e&&t?(d(t),e):(window.localStorage.clear(),null)}catch(a){return null}}()),t=Object(s.a)(e,2),a=t[0],n=t[1],l=a?"USER: ".concat(a):"Login or Create New User";return c.a.createElement("div",{className:"App"},c.a.createElement("h1",null,"HSL CITYBIKE CHECKER"),c.a.createElement("h3",null,l),a?c.a.createElement(R,null):c.a.createElement(L,{setUser:n}),c.a.createElement("br",null),a&&c.a.createElement("button",{onClick:function(){window.localStorage.clear(),n(null)}},"LOGOUT"))};o.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(U,null)),document.getElementById("root"))}},[[17,1,2]]]);
//# sourceMappingURL=main.2af2e919.chunk.js.map