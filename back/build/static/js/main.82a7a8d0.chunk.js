(this.webpackJsonpbike_checker=this.webpackJsonpbike_checker||[]).push([[0],{17:function(e,t,n){e.exports=n(45)},22:function(e,t,n){},23:function(e,t,n){},42:function(e,t,n){},43:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),l=n(15),o=n.n(l),s=(n(22),n(3)),u=(n(23),n(1)),i=n.n(u),m=n(4),E={BIKE_API_URI:"./api",LOGIN_API_URI:"https://safe-retreat-57854.herokuapp.com"},b=n(5),f=n.n(b),p=function(){return{headers:{Authorization:a}}},d=function(e){a=e?"bearer ".concat(e):null},I="".concat(E.BIKE_API_URI,"/v1/bikeData"),S=0,v={getBikeData:function(){var e=Object(m.a)(i.a.mark((function e(){var t,n,a,r,c,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(new Date).valueOf(),6e4,!(S>t-6e4)){e.next=4;break}return e.abrupt("return",null);case 4:return e.prev=4,n=p(),e.next=8,f.a.get(I,n);case 8:if(200===(a=e.sent).status&&a.data&&a.data.bikeData){e.next=12;break}return console.log("BIKEDATA: FETCH FAILED",a.status),e.abrupt("return",null);case 12:return r=a.data.bikeData,c=r.lastFetchTime,l=r.stations,S=c,e.abrupt("return",{lastFetchTime:c,stations:l});case 17:return e.prev=17,e.t0=e.catch(4),e.t0.response?console.log("BIKEDATA: FETCH FAILED",e.t0.response.statusText):console.log("BIKEDATA: FETCH FAILED",e.t0.status),e.abrupt("return",null);case 21:case"end":return e.stop()}}),e,null,[[4,17]])})));return function(){return e.apply(this,arguments)}}(),resetLastFetchTime:function(){return S=0}},g=n(16),A=(n(42),"".concat(E.LOGIN_API_URI,"/api/users")),O="".concat(E.LOGIN_API_URI,"/api/login"),h="".concat(E.LOGIN_API_URI,"/api/storeStation"),T={login:function(){var e=Object(m.a)(i.a.mark((function e(t,n){var a,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.a.post(O,{username:t,password:n});case 3:if(201===(a=e.sent).status&&a.data){e.next=7;break}return console.log("LOGIN: FAILED",a.status),e.abrupt("return",{isLoggedIn:!1});case 7:return console.log("LOGIN DONE"),(r=a.data.token)&&d(r),""!==a.data.token&&window.localStorage.setItem("userToken",a.data.token),e.abrupt("return",{isLoggedIn:!0,station:a.data.station});case 14:return e.prev=14,e.t0=e.catch(0),console.error("LOGIN: FAILED",e.t0.message),e.abrupt("return",{isLoggedIn:!1});case 18:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,n){return e.apply(this,arguments)}}(),createUser:function(){var e=Object(m.a)(i.a.mark((function e(t,n){var a,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n){e.next=2;break}return e.abrupt("return",{bCreated:!1,message:"MISSING USERNAME OR PASSWORD"});case 2:return e.prev=2,e.next=5,f.a.post(A,{username:t,password:n});case 5:if(201===(a=e.sent).status&&a.data){e.next=9;break}return console.log("LOGIN: FAILED",a.status),e.abrupt("return",{bCreated:!1,message:"USERNAME IN USE EXISTS"});case 9:return console.log("CREATED USER AND LOGGED IN DONE"),(r=a.data.token)&&d(r),""!==a.data.token&&window.localStorage.setItem("userToken",a.data.token),e.abrupt("return",{bCreated:!0,message:"USER CREATED"});case 16:return e.prev=16,e.t0=e.catch(2),console.error(e.t0.message),e.abrupt("return",{bCreated:!1,message:"USERNAME IN USE"});case 20:case"end":return e.stop()}}),e,null,[[2,16]])})));return function(t,n){return e.apply(this,arguments)}}(),storeHomeStation:function(){var e=Object(m.a)(i.a.mark((function e(t){var n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={station:t},console.log(n),a=p(),e.next=6,f.a.post(h,n,a);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0.message);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()},k=function(e){var t=e.station,n=e.selectCenter,a=e.isCenter,r=t.name,l=t.bikesAvailable,o=l+t.spacesAvailable,s="".concat(l," / ").concat(o),u=a?"station-list-item center":"station-list-item",i="bad";return l>3?i="good":l>0&&(i="neutral"),c.a.createElement("tr",{className:u,onDoubleClick:function(){return n(t)}},c.a.createElement("td",null,r),c.a.createElement("td",null,s),c.a.createElement("td",null,c.a.createElement("div",{className:"status-marker ".concat(i)})))},N=function(e){var t=e.centerId,n=e.setCenter,a=e.stations,l=e.lastFetchTime,o=Object(r.useState)(""),u=Object(s.a)(o,2),i=u[0],m=u[1];if(0===a.length)return c.a.createElement("div",null,c.a.createElement("br",null),"FETCHING DATA - WAIT A MOMENT");var E=function(e){var t=Object(g.a)({lastFetchTime:l},e);window.localStorage.setItem("centerStation",JSON.stringify(t)),T.storeHomeStation(t),n(t)},b=i.toLowerCase(),f=a.filter((function(e){return e.name.toLowerCase().includes(b)})).map((function(e){return c.a.createElement(k,{key:e.stationId,station:e,selectCenter:E,isCenter:e.stationId===t})}));return c.a.createElement("div",null,c.a.createElement("br",null),"FILTER STATIONS: ",c.a.createElement("input",{onChange:function(e){return m(e.target.value)},list:"nameData",value:i,type:"search"}),c.a.createElement("br",null),"Double Click to select",c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement("table",{id:"station-list-table"},c.a.createElement("thead",null,c.a.createElement("tr",null,c.a.createElement("th",null,"NAME"),c.a.createElement("th",null,"BIKES/SPACE"))),c.a.createElement("tbody",null,f)),c.a.createElement("datalist",{id:"nameData"},a.map((function(e){return c.a.createElement("option",{key:e.stationId,value:e.name})}))))},w=(n(43),function(){var e=Object(m.a)(i.a.mark((function e(t){var n,a,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.getBikeData();case 2:if((n=e.sent)&&0!==n.lastFetchTime&&0!==n.stations.length){e.next=5;break}return e.abrupt("return");case 5:a=n.lastFetchTime,r=n.stations,t({lastFetchTime:a,stations:r});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),D=function(e){var t=e.center,n=t.name,a=t.bikesAvailable,r=a+t.spacesAvailable,l=0!==t.lastFetchTime?"".concat(a," / ").concat(r):"...updating",o="bad";return a>3?o="good":a>0&&(o="neutral"),c.a.createElement("table",{id:"center-table",className:o},c.a.createElement("thead",null,c.a.createElement("tr",{key:1},c.a.createElement("th",null,"NAME"),c.a.createElement("th",null,"BIKES/SPACE"))),c.a.createElement("tbody",null,c.a.createElement("tr",null,c.a.createElement("td",null,n),c.a.createElement("td",null,l))))},R=function(){var e=Object(r.useState)({lastFetchTime:0,stations:[]}),t=Object(s.a)(e,2),n=t[0],a=t[1],l=Object(r.useState)((function(){return function(){var e={name:"NO CENTER SELECTED",bikesAvailable:0,spacesAvailable:0,stationId:null};try{var t=window.localStorage.getItem("centerStation");if(t){var n=JSON.parse(t);return n.lastFetchTime=0,n.bikesAvailable=0,n.spacesAvailable=0,n.stationId=null,n}return e}catch(a){return e}}()})),o=Object(s.a)(l,2),u=o[0],i=o[1],m=Object(r.useState)(!u.name),E=Object(s.a)(m,2),b=E[0],f=E[1],p=n.lastFetchTime,d=n.stations;Object(r.useEffect)((function(){w(a);var e=setInterval((function(){w(a)}),1e4);return function(){v.resetLastFetchTime(),clearTimeout(e)}}),[]);var I=d.find((function(e){return e.stationId===u.stationId}));I||(I=d.find((function(e){return e.name===u.name}))||u);var S=new Date(p||u.lastFetchTime).toLocaleString(),g=b?"HIDE LIST":"CHANGE STATION";return c.a.createElement("div",{id:"station-screen"},c.a.createElement("div",{id:"center-screen"},c.a.createElement("h2",null,"YOUR STATION"),c.a.createElement(D,{center:I}),c.a.createElement("br",null),S),c.a.createElement("br",null),c.a.createElement("button",{onClick:function(){return f((function(e){return!e}))}},g),c.a.createElement("br",null),b&&c.a.createElement(N,{centerId:u.stationId,setCenter:i,stations:d,lastFetchTime:p}))},C=(n(44),["name","lat","lon"]),L=function(e){var t=e.setUser,n=Object(r.useState)(""),a=Object(s.a)(n,2),l=a[0],o=a[1],u=Object(r.useState)(""),E=Object(s.a)(u,2),b=E[0],f=E[1],p=Object(r.useState)(""),d=Object(s.a)(p,2),I=d[0],S=d[1],v=function(){var e=Object(m.a)(i.a.mark((function e(n){var a,r,c,o,s,u,m;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),""!==l&&""!==b){e.next=6;break}return console.log("MISSIN USERNAME OR PASSWORD"),S("MISSIN USERNAME OR PASSWORD"),setTimeout((function(){S("")}),5e3),e.abrupt("return");case 6:return e.next=8,T.login(l,b);case 8:if(a=e.sent,r=a.isLoggedIn,c=a.station,r){if(c&&C.every((function(e){return c[e]}))){o=c.name,s=c.lat,u=c.lon;try{m={name:o,stationId:null,bikesAvailable:null,spacesAvailable:null,realtime:null,lat:s,lon:u,allowDropoff:null,lastFetchTime:0},window.localStorage.setItem("centerStation",JSON.stringify(m))}catch(i){console.error(i)}}window.localStorage.setItem("storedUser",l),t(l)}else console.log("LOGIN FAILED"),S("INVALID USER INFORMATION"),setTimeout((function(){S("")}),5e3);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=Object(m.a)(i.a.mark((function e(n){var a,r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),""!==l&&""!==b){e.next=6;break}return console.log("MISSIN USERNAME OR PASSWORD"),S("MISSIN USERNAME OR PASSWORD"),setTimeout((function(){S("")}),5e3),e.abrupt("return");case 6:return e.next=8,T.createUser(l,b);case 8:a=e.sent,r=a.bCreated,c=a.message,r?(window.localStorage.setItem("storedUser",l),t(l)):(console.log("LOGIN FAILED"),S(c),setTimeout((function(){S("")}),5e3));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return c.a.createElement("div",{id:"login-screen"},c.a.createElement("form",{onSubmit:v},"USERNAME: ",c.a.createElement("input",{onChange:function(e){return o(e.target.value)},value:l,name:"username"}),c.a.createElement("br",null),"PASSWORD: ",c.a.createElement("input",{type:"password",onChange:function(e){return f(e.target.value)},name:"password",value:b}),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement("button",{type:"submit"},"LOGIN USER"),c.a.createElement("button",{type:"button",onClick:g},"CREATE USER"),c.a.createElement("br",null),c.a.createElement("br",null),I,c.a.createElement("br",null)))},U=function(){var e=Object(r.useState)(function(){try{var e=window.localStorage.getItem("storedUser"),t=window.localStorage.getItem("userToken");return e&&t?(d(t),e):(window.localStorage.clear(),null)}catch(n){return null}}()),t=Object(s.a)(e,2),n=t[0],a=t[1],l=n?"USER: ".concat(n):"Login or Create New User";return c.a.createElement("div",{className:"App"},c.a.createElement("h1",null,"HSL CITYBIKE CHECKER"),c.a.createElement("h3",null,l),n?c.a.createElement(R,null):c.a.createElement(L,{setUser:a}),c.a.createElement("br",null),n&&c.a.createElement("button",{onClick:function(){window.localStorage.clear(),a(null)}},"LOGOUT"))};o.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(U,null)),document.getElementById("root"))}},[[17,1,2]]]);
//# sourceMappingURL=main.82a7a8d0.chunk.js.map